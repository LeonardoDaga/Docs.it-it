---
title: Considerazioni sulla sicurezza in ASP.NET Core SignalR
author: tdykstra
description: Informazioni su come usare l'autenticazione e autorizzazione in ASP.NET Core SignalR.
monikerRange: '>= aspnetcore-2.1'
ms.author: anurse
ms.custom: mvc
ms.date: 10/17/2018
uid: signalr/security
ms.openlocfilehash: 1adf762cd6de4f0cf62e31c0ec6e595a32ed56f8
ms.sourcegitcommit: f5d403004f3550e8c46585fdbb16c49e75f495f3
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/20/2018
ms.locfileid: "49477540"
---
# <a name="security-considerations-in-aspnet-core-signalr"></a><span data-ttu-id="5bb64-103">Considerazioni sulla sicurezza in ASP.NET Core SignalR</span><span class="sxs-lookup"><span data-stu-id="5bb64-103">Security considerations in ASP.NET Core SignalR</span></span>

<span data-ttu-id="5bb64-104">Da [Andrew Stanton-Nurse](https://twitter.com/anurse)</span><span class="sxs-lookup"><span data-stu-id="5bb64-104">By [Andrew Stanton-Nurse](https://twitter.com/anurse)</span></span>

<span data-ttu-id="5bb64-105">Questo articolo fornisce informazioni sulla protezione di SignalR.</span><span class="sxs-lookup"><span data-stu-id="5bb64-105">This article provides information on securing SignalR.</span></span>

## <a name="cross-origin-resource-sharing"></a><span data-ttu-id="5bb64-106">Cross-origin resource Sharing, condivisione</span><span class="sxs-lookup"><span data-stu-id="5bb64-106">Cross-origin resource sharing</span></span>

<span data-ttu-id="5bb64-107">[Cross-origin resource sharing (CORS)](https://www.w3.org/TR/cors/) può essere utilizzato per consentire le connessioni SignalR multiorigine nel browser.</span><span class="sxs-lookup"><span data-stu-id="5bb64-107">[Cross-origin resource sharing (CORS)](https://www.w3.org/TR/cors/) can be used to allow cross-origin SignalR connections in the browser.</span></span> <span data-ttu-id="5bb64-108">Se il codice JavaScript è ospitato in un dominio diverso dall'app, SignalR [middleware CORS](xref:security/cors) deve essere abilitata per consentire il codice JavaScript per la connessione all'app di SignalR.</span><span class="sxs-lookup"><span data-stu-id="5bb64-108">If JavaScript code is hosted on a different domain from the SignalR app, [CORS middleware](xref:security/cors) must be enabled to allow the JavaScript to connect to the SignalR app.</span></span> <span data-ttu-id="5bb64-109">Consentire richieste multiorigine solo dal controllo o di domini che attendibili.</span><span class="sxs-lookup"><span data-stu-id="5bb64-109">Allow cross-origin requests only from domains you trust or control.</span></span> <span data-ttu-id="5bb64-110">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="5bb64-110">For example:</span></span>

* <span data-ttu-id="5bb64-111">Il sito è ospitato in `http://www.example.com`</span><span class="sxs-lookup"><span data-stu-id="5bb64-111">Your site is hosted on `http://www.example.com`</span></span>
* <span data-ttu-id="5bb64-112">L'app di SignalR è ospitato in `http://signalr.example.com`</span><span class="sxs-lookup"><span data-stu-id="5bb64-112">Your SignalR app is hosted on `http://signalr.example.com`</span></span>

<span data-ttu-id="5bb64-113">CORS deve essere configurato nell'app SignalR per consentire solo l'origine `www.example.com`.</span><span class="sxs-lookup"><span data-stu-id="5bb64-113">CORS should be configured in the SignalR app to only allow the origin `www.example.com`.</span></span>

<span data-ttu-id="5bb64-114">Per altre informazioni sulla configurazione di CORS, vedere [abilita la richieste (CORS)](xref:security/cors).</span><span class="sxs-lookup"><span data-stu-id="5bb64-114">For more information on configuring CORS, see [Enable Cross-Origin Requests (CORS)](xref:security/cors).</span></span> <span data-ttu-id="5bb64-115">SignalR **richiede** i criteri CORS seguenti:</span><span class="sxs-lookup"><span data-stu-id="5bb64-115">SignalR **requires** the following CORS policies:</span></span>

* <span data-ttu-id="5bb64-116">Consenti le specifiche origini previsto.</span><span class="sxs-lookup"><span data-stu-id="5bb64-116">Allow the specific expected origins.</span></span> <span data-ttu-id="5bb64-117">Consentire qualsiasi origine, è possibile ma viene **non** sicura o consigliati.</span><span class="sxs-lookup"><span data-stu-id="5bb64-117">Allowing any origin is possible but is **not** secure or recommended.</span></span>
* <span data-ttu-id="5bb64-118">Metodi HTTP `GET` e `POST` devono essere consentiti.</span><span class="sxs-lookup"><span data-stu-id="5bb64-118">HTTP methods `GET` and `POST` must be allowed.</span></span>
* <span data-ttu-id="5bb64-119">Anche quando non viene utilizzata l'autenticazione, è necessario abilitare le credenziali.</span><span class="sxs-lookup"><span data-stu-id="5bb64-119">Credentials must be enabled, even when authentication is not used.</span></span>

<span data-ttu-id="5bb64-120">Ad esempio, il seguente criterio CORS consente a un client di browser SignalR ospitato in `http://example.com` per accedere all'app di SignalR ospitato su `http://signalr.example.com`:</span><span class="sxs-lookup"><span data-stu-id="5bb64-120">For example, the following CORS policy allows a SignalR browser client hosted on `http://example.com` to access the SignalR app hosted on `http://signalr.example.com`:</span></span>

[!code-csharp[Main](security/sample/Startup.cs?name=snippet1)]

> [!NOTE]
> <span data-ttu-id="5bb64-121">SignalR non è compatibile con la funzionalità incorporata di CORS nel servizio App di Azure.</span><span class="sxs-lookup"><span data-stu-id="5bb64-121">SignalR is not compatible with the built-in CORS feature in Azure App Service.</span></span>

## <a name="websocket-origin-restriction"></a><span data-ttu-id="5bb64-122">Restrizione di origine di WebSocket</span><span class="sxs-lookup"><span data-stu-id="5bb64-122">WebSocket Origin Restriction</span></span>

<span data-ttu-id="5bb64-123">La protezione fornita dalle CORS non si applicano agli oggetti WebSocket.</span><span class="sxs-lookup"><span data-stu-id="5bb64-123">The protections provided by CORS don't apply to WebSockets.</span></span> <span data-ttu-id="5bb64-124">Browser **non**:</span><span class="sxs-lookup"><span data-stu-id="5bb64-124">Browsers do **not**:</span></span>

* <span data-ttu-id="5bb64-125">Eseguire richieste preliminari CORS.</span><span class="sxs-lookup"><span data-stu-id="5bb64-125">Perform CORS pre-flight requests.</span></span>
* <span data-ttu-id="5bb64-126">Rispettare le restrizioni specificate in `Access-Control` intestazioni quando si effettuano le richieste WebSocket.</span><span class="sxs-lookup"><span data-stu-id="5bb64-126">Respect the restrictions specified in `Access-Control` headers when making WebSocket requests.</span></span>

<span data-ttu-id="5bb64-127">Tuttavia, i browser inviano il `Origin` intestazione quando si inviano richieste WebSocket.</span><span class="sxs-lookup"><span data-stu-id="5bb64-127">However, browsers do send the `Origin` header when issuing WebSocket requests.</span></span> <span data-ttu-id="5bb64-128">Le applicazioni devono essere configurate per convalidare le intestazioni per assicurarsi che siano consentite solo WebSockets provenienti da origini previsto.</span><span class="sxs-lookup"><span data-stu-id="5bb64-128">Applications should be configured to validate these headers to ensure that only WebSockets coming from the expected origins are allowed.</span></span>

<span data-ttu-id="5bb64-129">In ASP.NET Core 2.1 e versioni successive, è possibile ottenere la convalida delle intestazioni utilizzando un middleware personalizzato inserito **prima `UseSignalR`e middleware di autenticazione** in `Configure`:</span><span class="sxs-lookup"><span data-stu-id="5bb64-129">In ASP.NET Core 2.1 and later, header validation can be achieved using a custom middleware placed **before `UseSignalR`, and authentication middleware** in `Configure`:</span></span>

[!code-csharp[Main](security/sample/Startup.cs?name=snippet2)]

> [!NOTE]
> <span data-ttu-id="5bb64-130">Il `Origin` intestazione è controllata dal client e, come il `Referer` intestazione, possono essere falsificati.</span><span class="sxs-lookup"><span data-stu-id="5bb64-130">The `Origin` header is controlled by the client and, like the `Referer` header, can be faked.</span></span> <span data-ttu-id="5bb64-131">Queste intestazioni devono **non** utilizzabile come un meccanismo di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="5bb64-131">These headers should **not** be used as an authentication mechanism.</span></span>

## <a name="access-token-logging"></a><span data-ttu-id="5bb64-132">Registrazione di token di accesso</span><span class="sxs-lookup"><span data-stu-id="5bb64-132">Access token logging</span></span>

<span data-ttu-id="5bb64-133">Quando si usa WebSocket o Server-Sent eventi, il browser client invia il token di accesso nella stringa di query.</span><span class="sxs-lookup"><span data-stu-id="5bb64-133">When using WebSockets or Server-Sent Events, the browser client sends the access token in the query string.</span></span> <span data-ttu-id="5bb64-134">Ricevere il token di accesso tramite la stringa di query è in genere sicuro quanto lo standard `Authorization` intestazione.</span><span class="sxs-lookup"><span data-stu-id="5bb64-134">Receiving the access token via query string is generally as secure as using the standard `Authorization` header.</span></span> <span data-ttu-id="5bb64-135">Tuttavia, molti server web registrare l'URL per ogni richiesta, tra cui la stringa di query.</span><span class="sxs-lookup"><span data-stu-id="5bb64-135">However, many web servers log the URL for each request, including the query string.</span></span> <span data-ttu-id="5bb64-136">Gli URL di registrazione può accedere il token di accesso.</span><span class="sxs-lookup"><span data-stu-id="5bb64-136">Logging the URLs may log the access token.</span></span> <span data-ttu-id="5bb64-137">Una procedura consigliata consiste nell'impostare le impostazioni di registrazione del server per evitare che i token di accesso di registrazione web.</span><span class="sxs-lookup"><span data-stu-id="5bb64-137">A best practice is to set the web server's logging settings to prevent logging access tokens.</span></span>

## <a name="exceptions"></a><span data-ttu-id="5bb64-138">Eccezioni</span><span class="sxs-lookup"><span data-stu-id="5bb64-138">Exceptions</span></span>

<span data-ttu-id="5bb64-139">I messaggi di eccezione sono in genere considerati dati sensibili che non devono essere rivelati al client.</span><span class="sxs-lookup"><span data-stu-id="5bb64-139">Exception messages are generally considered sensitive data that shouldn't be revealed to a client.</span></span> <span data-ttu-id="5bb64-140">Per impostazione predefinita, SignalR non invia i dettagli di un'eccezione generata da un metodo dell'hub al client.</span><span class="sxs-lookup"><span data-stu-id="5bb64-140">By default, SignalR doesn't send the details of an exception thrown by a hub method to the client.</span></span> <span data-ttu-id="5bb64-141">Al contrario, il client riceve un messaggio generico che indica che un errore.</span><span class="sxs-lookup"><span data-stu-id="5bb64-141">Instead, the client receives a generic message indicating an error occurred.</span></span> <span data-ttu-id="5bb64-142">Recapito dei messaggi di eccezione al client può essere sostituito (ad esempio in sviluppo o test) da [ `EnableDetailedErrors` ](xref:signalr/configuration#configure-server-options).</span><span class="sxs-lookup"><span data-stu-id="5bb64-142">Exception message delivery to the client can be overridden (for example in development or test) with [`EnableDetailedErrors`](xref:signalr/configuration#configure-server-options).</span></span> <span data-ttu-id="5bb64-143">I messaggi di eccezione non devono essere esposti al client in app di produzione.</span><span class="sxs-lookup"><span data-stu-id="5bb64-143">Exception messages should not be exposed to the client in production apps.</span></span>

## <a name="buffer-management"></a><span data-ttu-id="5bb64-144">Gestione del buffer</span><span class="sxs-lookup"><span data-stu-id="5bb64-144">Buffer management</span></span>

<span data-ttu-id="5bb64-145">SignalR utilizza i buffer per ogni connessione per gestire i messaggi in ingresso e in uscita.</span><span class="sxs-lookup"><span data-stu-id="5bb64-145">SignalR uses per-connection buffers to manage incoming and outgoing messages.</span></span> <span data-ttu-id="5bb64-146">Per impostazione predefinita, SignalR limita i buffer su 32 KB.</span><span class="sxs-lookup"><span data-stu-id="5bb64-146">By default, SignalR limits these buffers to 32 KB.</span></span> <span data-ttu-id="5bb64-147">Il messaggio più grande di che un client o server può inviare è 32 KB.</span><span class="sxs-lookup"><span data-stu-id="5bb64-147">The largest message a client or server can send is 32 KB.</span></span> <span data-ttu-id="5bb64-148">La memoria massima usata da una connessione per i messaggi è 32 KB.</span><span class="sxs-lookup"><span data-stu-id="5bb64-148">The maximum memory consumed by a connection for messages is 32 KB.</span></span> <span data-ttu-id="5bb64-149">Se i messaggi sono sempre minori di 32 KB, è possibile ridurre il limite, quali:</span><span class="sxs-lookup"><span data-stu-id="5bb64-149">If your messages are always smaller than 32 KB, you can reduce the limit, which:</span></span>

* <span data-ttu-id="5bb64-150">Impedisce la possibilità di inviare un messaggio di dimensioni maggiori di un client.</span><span class="sxs-lookup"><span data-stu-id="5bb64-150">Prevents a client from being able to send a larger message.</span></span>
* <span data-ttu-id="5bb64-151">Il server non sarà mai necessario allocare buffer di grandi dimensioni per accettare i messaggi.</span><span class="sxs-lookup"><span data-stu-id="5bb64-151">The server will never need to allocate large buffers to accept messages.</span></span>

<span data-ttu-id="5bb64-152">Se i messaggi sono superiori a 32 KB, è possibile aumentare il limite.</span><span class="sxs-lookup"><span data-stu-id="5bb64-152">If your messages are larger than 32 KB, you can increase the limit.</span></span> <span data-ttu-id="5bb64-153">Aumentare questo limite si intende:</span><span class="sxs-lookup"><span data-stu-id="5bb64-153">Increasing this limit means:</span></span>

* <span data-ttu-id="5bb64-154">Il client può causare il server di allocare i buffer di memoria di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="5bb64-154">The client can cause the server to allocate large memory buffers.</span></span>
* <span data-ttu-id="5bb64-155">Allocazione di server di buffer di grandi dimensioni può ridurre il numero di connessioni simultanee.</span><span class="sxs-lookup"><span data-stu-id="5bb64-155">Server allocation of large buffers may reduce the number of concurrent connections.</span></span>

<span data-ttu-id="5bb64-156">Sono previsti limiti per i messaggi in ingresso e in uscita, entrambi possono essere configurate nel [ `HttpConnectionDispatcherOptions` ](xref:signalr/configuration#configure-server-options) configurato nell'oggetto `MapHub`:</span><span class="sxs-lookup"><span data-stu-id="5bb64-156">There are limits for incoming and outgoing messages, both can be configured on the [`HttpConnectionDispatcherOptions`](xref:signalr/configuration#configure-server-options) object configured in `MapHub`:</span></span>

* <span data-ttu-id="5bb64-157">`ApplicationMaxBufferSize` rappresenta il numero massimo di byte dal client che il buffer del server.</span><span class="sxs-lookup"><span data-stu-id="5bb64-157">`ApplicationMaxBufferSize` represents the maximum number of bytes from the client that the server buffers.</span></span> <span data-ttu-id="5bb64-158">Se il client tenta di inviare un messaggio di dimensioni superiori a questo limite, la connessione verrà chiusa.</span><span class="sxs-lookup"><span data-stu-id="5bb64-158">If the client attempts to send a message larger than this limit, the connection may be closed.</span></span>
* <span data-ttu-id="5bb64-159">`TransportMaxBufferSize` rappresenta il numero massimo di byte che il server può inviare.</span><span class="sxs-lookup"><span data-stu-id="5bb64-159">`TransportMaxBufferSize` represents the maximum number of bytes the server can send.</span></span> <span data-ttu-id="5bb64-160">Se il server tenta di inviare un messaggio (tra cui i valori restituiti dai metodi dell'hub) superano questo limite, verrà generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="5bb64-160">If the server attempts to send a message (including return values from hub methods) larger than this limit, an exception will be thrown.</span></span>

<span data-ttu-id="5bb64-161">L'impostazione del limite `0` disattiva il limite.</span><span class="sxs-lookup"><span data-stu-id="5bb64-161">Setting the limit to `0` disables the limit.</span></span> <span data-ttu-id="5bb64-162">Rimozione del limite consente a un client inviare un messaggio di qualsiasi dimensione.</span><span class="sxs-lookup"><span data-stu-id="5bb64-162">Removing the limit allows a client to send a message of any size.</span></span> <span data-ttu-id="5bb64-163">Client non autorizzati l'invio di messaggi di grandi dimensioni può causare in eccesso della memoria da allocare.</span><span class="sxs-lookup"><span data-stu-id="5bb64-163">Malicious clients sending large messages can cause excess memory to be allocated.</span></span> <span data-ttu-id="5bb64-164">Utilizzo della memoria in eccesso possa ridurre notevolmente il numero di connessioni simultanee.</span><span class="sxs-lookup"><span data-stu-id="5bb64-164">Excess memory usage can significantly reduce the number of concurrent connections.</span></span>
