---
uid: signalr/overview/guide-to-the-api/handling-connection-lifetime-events
title: Comprensione e gestione degli eventi di durata connessione in SignalR | Microsoft Docs
author: pfletcher
description: Questo articolo descrive come usare gli eventi esposti dall'API di hub.
ms.author: riande
ms.date: 06/10/2014
ms.assetid: 03960de2-8d95-4444-9169-4426dcc64913
msc.legacyurl: /signalr/overview/guide-to-the-api/handling-connection-lifetime-events
msc.type: authoredcontent
ms.openlocfilehash: 6a354179a82eba1d4a64184bfdeb302472fabf5f
ms.sourcegitcommit: 74e3be25ea37b5fc8b4b433b0b872547b4b99186
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 12/12/2018
ms.locfileid: "53287981"
---
<a name="understanding-and-handling-connection-lifetime-events-in-signalr"></a><span data-ttu-id="89cc6-103">Comprensione e gestione degli eventi di durata connessione in SignalR</span><span class="sxs-lookup"><span data-stu-id="89cc6-103">Understanding and Handling Connection Lifetime Events in SignalR</span></span>
====================
<span data-ttu-id="89cc6-104">dal [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="89cc6-104">by [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="89cc6-105">Questo articolo offre una panoramica degli eventi di connessione e riconnessione disconnessione SignalR che è possibile gestire e le impostazioni di timeout e keepalive che è possibile configurare.</span><span class="sxs-lookup"><span data-stu-id="89cc6-105">This article provides an overview of the SignalR connection, reconnection, and disconnection events that you can handle, and timeout and keepalive settings that you can configure.</span></span>
>
> <span data-ttu-id="89cc6-106">L'articolo si presuppone già una conoscenza di eventi di durata SignalR e connessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-106">The article assumes you already have some knowledge of SignalR and connection lifetime events.</span></span> <span data-ttu-id="89cc6-107">Per un'introduzione a SignalR, vedere [Introduzione a SignalR](../getting-started/introduction-to-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="89cc6-107">For an introduction to SignalR, see [Introduction to SignalR](../getting-started/introduction-to-signalr.md).</span></span> <span data-ttu-id="89cc6-108">Per un elenco di eventi di durata connessione, vedere le risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="89cc6-108">For lists of connection lifetime events, see the following resources:</span></span>
>
> - [<span data-ttu-id="89cc6-109">Come gestire gli eventi di durata connessione nella classe Hub</span><span class="sxs-lookup"><span data-stu-id="89cc6-109">How to handle connection lifetime events in the Hub class</span></span>](hubs-api-guide-server.md#connectionlifetime)
> - [<span data-ttu-id="89cc6-110">Come gestire gli eventi di durata connessione nei client JavaScript</span><span class="sxs-lookup"><span data-stu-id="89cc6-110">How to handle connection lifetime events in JavaScript clients</span></span>](hubs-api-guide-javascript-client.md#connectionlifetime)
> - [<span data-ttu-id="89cc6-111">Come gestire gli eventi di durata connessione nei client .NET</span><span class="sxs-lookup"><span data-stu-id="89cc6-111">How to handle connection lifetime events in .NET clients</span></span>](hubs-api-guide-net-client.md#connectionlifetime)
>
> ## <a name="software-versions-used-in-this-topic"></a><span data-ttu-id="89cc6-112">Versioni del software utilizzate in questo argomento</span><span class="sxs-lookup"><span data-stu-id="89cc6-112">Software versions used in this topic</span></span>
>
>
> - [<span data-ttu-id="89cc6-113">Visual Studio 2013</span><span class="sxs-lookup"><span data-stu-id="89cc6-113">Visual Studio 2013</span></span>](https://my.visualstudio.com/Downloads?q=visual%20studio%202013)
> - <span data-ttu-id="89cc6-114">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="89cc6-114">.NET 4.5</span></span>
> - <span data-ttu-id="89cc6-115">SignalR versione 2</span><span class="sxs-lookup"><span data-stu-id="89cc6-115">SignalR version 2</span></span>
>
>
>
> ## <a name="previous-versions-of-this-topic"></a><span data-ttu-id="89cc6-116">Versioni precedenti di questo argomento</span><span class="sxs-lookup"><span data-stu-id="89cc6-116">Previous versions of this topic</span></span>
>
> <span data-ttu-id="89cc6-117">Per informazioni sulle versioni precedenti di SignalR, vedere [le versioni precedenti di SignalR](../older-versions/index.md).</span><span class="sxs-lookup"><span data-stu-id="89cc6-117">For information about earlier versions of SignalR, see [SignalR Older Versions](../older-versions/index.md).</span></span>
>
> ## <a name="questions-and-comments"></a><span data-ttu-id="89cc6-118">Domande e commenti</span><span class="sxs-lookup"><span data-stu-id="89cc6-118">Questions and comments</span></span>
>
> <span data-ttu-id="89cc6-119">Inviaci un feedback sul modo in cui è stato apprezzato questa esercitazione e cosa possiamo migliorare nei commenti nella parte inferiore della pagina.</span><span class="sxs-lookup"><span data-stu-id="89cc6-119">Please leave feedback on how you liked this tutorial and what we could improve in the comments at the bottom of the page.</span></span> <span data-ttu-id="89cc6-120">Se hai domande che non sono direttamente correlate con l'esercitazione, è possibile pubblicarli per i [forum ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) oppure [StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="89cc6-120">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com/).</span></span>

## <a name="overview"></a><span data-ttu-id="89cc6-121">Panoramica</span><span class="sxs-lookup"><span data-stu-id="89cc6-121">Overview</span></span>

<span data-ttu-id="89cc6-122">In questo articolo sono contenute le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="89cc6-122">This article contains the following sections:</span></span>

- [<span data-ttu-id="89cc6-123">Scenari e la terminologia di durata connessione</span><span class="sxs-lookup"><span data-stu-id="89cc6-123">Connection lifetime terminology and scenarios</span></span>](#terminology)

    - [<span data-ttu-id="89cc6-124">Le connessioni SignalR, connessioni di trasporto e connessioni fisiche</span><span class="sxs-lookup"><span data-stu-id="89cc6-124">SignalR connections, transport connections, and physical connections</span></span>](#signalrvstransport)
    - [<span data-ttu-id="89cc6-125">Scenari di disconnessione del trasporto</span><span class="sxs-lookup"><span data-stu-id="89cc6-125">Transport disconnection scenarios</span></span>](#transportdisconnect)
    - [<span data-ttu-id="89cc6-126">Scenari di disconnessione client</span><span class="sxs-lookup"><span data-stu-id="89cc6-126">Client disconnection scenarios</span></span>](#clientdisconnect)
    - [<span data-ttu-id="89cc6-127">Scenari di disconnessione del server</span><span class="sxs-lookup"><span data-stu-id="89cc6-127">Server disconnection scenarios</span></span>](#serverdisconnect)
- [<span data-ttu-id="89cc6-128">Impostazioni di timeout e keepalive</span><span class="sxs-lookup"><span data-stu-id="89cc6-128">Timeout and keepalive settings</span></span>](#timeoutkeepalive)

    - [<span data-ttu-id="89cc6-129">ConnectionTimeout</span><span class="sxs-lookup"><span data-stu-id="89cc6-129">ConnectionTimeout</span></span>](#connectiontimeout)
    - [<span data-ttu-id="89cc6-130">DisconnectTimeout</span><span class="sxs-lookup"><span data-stu-id="89cc6-130">DisconnectTimeout</span></span>](#disconnecttimeout)
    - [<span data-ttu-id="89cc6-131">KeepAlive</span><span class="sxs-lookup"><span data-stu-id="89cc6-131">KeepAlive</span></span>](#keepalive)
    - [<span data-ttu-id="89cc6-132">Come modificare le impostazioni di timeout e keepalive</span><span class="sxs-lookup"><span data-stu-id="89cc6-132">How to change timeout and keepalive settings</span></span>](#changetimeout)
- [<span data-ttu-id="89cc6-133">Come inviare una notifica all'utente disconnessioni</span><span class="sxs-lookup"><span data-stu-id="89cc6-133">How to notify the user about disconnections</span></span>](#notifydisconnect)
- [<span data-ttu-id="89cc6-134">Modalità di riconnessione in modo continuo</span><span class="sxs-lookup"><span data-stu-id="89cc6-134">How to continuously reconnect</span></span>](#continuousreconnect)
- [<span data-ttu-id="89cc6-135">Come disconnettere un client nel codice server</span><span class="sxs-lookup"><span data-stu-id="89cc6-135">How to disconnect a client in server code</span></span>](#disconnectclientfromserver)
- [<span data-ttu-id="89cc6-136">Rilevare il motivo di una disconnessione</span><span class="sxs-lookup"><span data-stu-id="89cc6-136">Detecting the reason for a disconnection</span></span>](#detectingreasonfordisconnection)

<span data-ttu-id="89cc6-137">I collegamenti agli argomenti di riferimento all'API sono alla versione dell'API .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="89cc6-137">Links to API Reference topics are to the .NET 4.5 version of the API.</span></span> <span data-ttu-id="89cc6-138">Se si usa .NET 4, vedere [la versione di .NET 4 degli argomenti API](https://msdn.microsoft.com/library/jj891075(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="89cc6-138">If you're using .NET 4, see [the .NET 4 version of the API topics](https://msdn.microsoft.com/library/jj891075(v=vs.100).aspx).</span></span>

<a id="terminology"></a>

## <a name="connection-lifetime-terminology-and-scenarios"></a><span data-ttu-id="89cc6-139">Scenari e la terminologia di durata connessione</span><span class="sxs-lookup"><span data-stu-id="89cc6-139">Connection lifetime terminology and scenarios</span></span>

<span data-ttu-id="89cc6-140">Il `OnReconnected` gestore dell'evento in un SignalR Hub può eseguire direttamente dopo `OnConnected` ma non dopo `OnDisconnected` per un determinato client.</span><span class="sxs-lookup"><span data-stu-id="89cc6-140">The `OnReconnected` event handler in a SignalR Hub can execute directly after `OnConnected` but not after `OnDisconnected` for a given client.</span></span> <span data-ttu-id="89cc6-141">Il motivo che è possibile avere una riconnessione senza una disconnessione è che esistono diversi modi in cui viene utilizzata la parola "connessione" in SignalR.</span><span class="sxs-lookup"><span data-stu-id="89cc6-141">The reason you can have a reconnection without a disconnection is that there are several ways in which the word "connection" is used in SignalR.</span></span>

<a id="signalrvstransport"></a>

### <a name="signalr-connections-transport-connections-and-physical-connections"></a><span data-ttu-id="89cc6-142">Le connessioni SignalR, connessioni di trasporto e connessioni fisiche</span><span class="sxs-lookup"><span data-stu-id="89cc6-142">SignalR connections, transport connections, and physical connections</span></span>

<span data-ttu-id="89cc6-143">Questo articolo verrà distinguere *le connessioni SignalR*, *connessioni di trasporto*, e *connessioni fisiche*:</span><span class="sxs-lookup"><span data-stu-id="89cc6-143">This article will differentiate between *SignalR connections*, *transport connections*, and *physical connections*:</span></span>

- <span data-ttu-id="89cc6-144">**Connessione SignalR** fa riferimento a una relazione logica tra un client e un URL del server, gestita dall'API SignalR e identificata da un ID di connessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-144">**SignalR connection** refers to a logical relationship between a client and a server URL, maintained by the SignalR API and uniquely identified by a connection ID.</span></span> <span data-ttu-id="89cc6-145">I dati relativi a questa relazione viene manutenuti da SignalR e viene usati per stabilire una connessione di trasporto.</span><span class="sxs-lookup"><span data-stu-id="89cc6-145">The data about this relationship is maintained by SignalR and is used to establish a transport connection.</span></span> <span data-ttu-id="89cc6-146">Le entità finali della relazione e SignalR Elimina i dati quando il client chiama il `Stop` metodo o un limite di timeout viene raggiunta mentre SignalR sta tentando di ristabilire una connessione di trasporto persi.</span><span class="sxs-lookup"><span data-stu-id="89cc6-146">The relationship ends and SignalR disposes of the data when the client calls the `Stop` method or a timeout limit is reached while SignalR is attempting to re-establish a lost transport connection.</span></span>
- <span data-ttu-id="89cc6-147">**Connessione di trasporto** fa riferimento a una relazione logica tra un client e un server, gestito da uno dei quattro trasporto API: WebSockets, gli eventi inviati al server, forever frame o polling di lunga durata.</span><span class="sxs-lookup"><span data-stu-id="89cc6-147">**Transport connection** refers to a logical relationship between a client and a server, maintained by one of the four transport APIs: WebSockets, server-sent events, forever frame, or long polling.</span></span> <span data-ttu-id="89cc6-148">SignalR utilizza il trasporto API per creare una connessione di trasporto e l'API di trasporto dipende dalla presenza di una connessione di rete fisica per creare la connessione di trasporto.</span><span class="sxs-lookup"><span data-stu-id="89cc6-148">SignalR uses the transport API to create a transport connection, and the transport API depends on the existence of a physical network connection to create the transport connection.</span></span> <span data-ttu-id="89cc6-149">La connessione di trasporto termina quando SignalR termina o quando il trasporto API rileva che la connessione fisica viene interrotta.</span><span class="sxs-lookup"><span data-stu-id="89cc6-149">The transport connection ends when SignalR terminates it or when the transport API detects that the physical connection is broken.</span></span>
- <span data-ttu-id="89cc6-150">**Connessione fisica** fa riferimento per i collegamenti di rete fisica, dei cavi, segnali wireless, i router e così via, che facilitano la comunicazione tra un computer client e un computer server.</span><span class="sxs-lookup"><span data-stu-id="89cc6-150">**Physical connection** refers to the physical network links -- wires, wireless signals, routers, etc. -- that facilitate communication between a client computer and a server computer.</span></span> <span data-ttu-id="89cc6-151">La connessione fisica deve essere presente per stabilire una connessione di trasporto e deve essere stabilita una connessione di trasporto per stabilire una connessione SignalR.</span><span class="sxs-lookup"><span data-stu-id="89cc6-151">The physical connection must be present in order to establish a transport connection, and a transport connection must be established in order to establish a SignalR connection.</span></span> <span data-ttu-id="89cc6-152">Tuttavia, la connessione fisica di rilievo non sempre immediatamente termina la connessione di trasporto o la connessione SignalR, come verrà spiegato più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="89cc6-152">However, breaking the physical connection doesn't always immediately end the transport connection or the SignalR connection, as will be explained later in this topic.</span></span>

<span data-ttu-id="89cc6-153">Nel diagramma seguente, la connessione SignalR è rappresentata dall'API di hub e livello PersistentConnection API SignalR, la connessione di trasporto è rappresentata dal livello di trasporto e la connessione fisica è rappresentata dalle linee tra i server e i client.</span><span class="sxs-lookup"><span data-stu-id="89cc6-153">In the following diagram, the SignalR connection is represented by the Hubs API and PersistentConnection API SignalR layer, the transport connection is represented by the Transports layer, and the physical connection is represented by the lines between the server and the clients.</span></span>

![Diagramma dell'architettura di SignalR](handling-connection-lifetime-events/_static/image1.png)

<span data-ttu-id="89cc6-155">Quando si chiama il `Start` metodo in un client SignalR, si fornisce il codice client di SignalR con tutte le informazioni necessarie per stabilire una connessione a un server fisica.</span><span class="sxs-lookup"><span data-stu-id="89cc6-155">When you call the `Start` method in a SignalR client, you are providing SignalR client code with all the information it needs in order to establish a physical connection to a server.</span></span> <span data-ttu-id="89cc6-156">Codice del client SignalR utilizza queste informazioni per eseguire una richiesta HTTP e stabilire una connessione fisica che utilizza uno dei metodi di quattro trasporto.</span><span class="sxs-lookup"><span data-stu-id="89cc6-156">SignalR client code uses this information to make an HTTP request and establish a physical connection that uses one of the four transport methods.</span></span> <span data-ttu-id="89cc6-157">Se si verifica un errore di connessione del trasporto o il server non riesce, la connessione SignalR non risolversi immediatamente perché il client dispone comunque le informazioni necessarie per ristabilire automaticamente una nuova connessione di trasporto per lo stesso URL di SignalR.</span><span class="sxs-lookup"><span data-stu-id="89cc6-157">If the transport connection fails or the server fails, the SignalR connection doesn't go away immediately because the client still has the information it needs to automatically re-establish a new transport connection to the same SignalR URL.</span></span> <span data-ttu-id="89cc6-158">In questo scenario, non è coinvolto alcun intervento dell'applicazione utente e quando il codice del client SignalR stabilisce una nuova connessione di trasporto, non si avvia una nuova connessione SignalR.</span><span class="sxs-lookup"><span data-stu-id="89cc6-158">In this scenario, no intervention from the user application is involved, and when the SignalR client code establishes a new transport connection, it does not start a new SignalR connection.</span></span> <span data-ttu-id="89cc6-159">La continuità della connessione SignalR si riflette il fatto che l'ID connessione, che viene creato quando si chiama il `Start` metodo, non viene modificata.</span><span class="sxs-lookup"><span data-stu-id="89cc6-159">The continuity of the SignalR connection is reflected in the fact that the connection ID, which is created when you call the `Start` method, does not change.</span></span>

<span data-ttu-id="89cc6-160">Il `OnReconnected` gestore eventi nell'Hub viene eseguito quando una connessione di trasporto viene automaticamente ristabilita dopo essere stata persa.</span><span class="sxs-lookup"><span data-stu-id="89cc6-160">The `OnReconnected` event handler on the Hub executes when a transport connection is automatically re-established after having been lost.</span></span> <span data-ttu-id="89cc6-161">Il `OnDisconnected` gestore eventi viene eseguito alla fine di una connessione SignalR.</span><span class="sxs-lookup"><span data-stu-id="89cc6-161">The `OnDisconnected` event handler executes at the end of a SignalR connection.</span></span> <span data-ttu-id="89cc6-162">Una connessione SignalR può terminare con uno dei modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="89cc6-162">A SignalR connection can end in any of the following ways:</span></span>

- <span data-ttu-id="89cc6-163">Se il client chiama il `Stop` metodo, viene inviato un messaggio di arresto al server e client e server terminare immediatamente la connessione di SignalR.</span><span class="sxs-lookup"><span data-stu-id="89cc6-163">If the client calls the `Stop` method, a stop message is sent to the server, and both client and server end the SignalR connection immediately.</span></span>
- <span data-ttu-id="89cc6-164">Dopo aver persa la connettività tra client e server, il client tenta di ristabilire la connessione e il server è in attesa per il client ristabilire la connessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-164">After connectivity between client and server is lost, the client tries to reconnect and the server waits for the client to reconnect.</span></span> <span data-ttu-id="89cc6-165">Se i tentativi per ristabilire la connessione hanno esito negativo e termina il periodo di timeout di disconnessione, client e server alla fine della connessione di SignalR.</span><span class="sxs-lookup"><span data-stu-id="89cc6-165">If the attempts to reconnect are unsuccessful and the disconnect timeout period ends, both client and server end the SignalR connection.</span></span> <span data-ttu-id="89cc6-166">Il client interrompe il tentativo di riconnettere ed elimina il server relativa rappresentazione della connessione SignalR.</span><span class="sxs-lookup"><span data-stu-id="89cc6-166">The client stops trying to reconnect, and the server disposes of its representation of the SignalR connection.</span></span>
- <span data-ttu-id="89cc6-167">Se il client non arresta l'esecuzione senza possibilità di chiamare il `Stop` metodo, il server attende che il client di riconnettersi e quindi termina la connessione SignalR dopo il periodo di timeout di disconnessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-167">If the client stops running without having a chance to call the `Stop` method, the server waits for the client to reconnect, and then ends the SignalR connection after the disconnect timeout period.</span></span>
- <span data-ttu-id="89cc6-168">Se il server si arresta in esecuzione, il client viene tentato riconnettersi (ricreare la connessione di trasporto) e quindi termina la connessione SignalR dopo il periodo di timeout di disconnessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-168">If the server stops running, the client tries to reconnect (re-create the transport connection), and then ends the SignalR connection after the disconnect timeout period.</span></span>

<span data-ttu-id="89cc6-169">Quando non siano presenti problemi di connessione e l'applicazione utente termina la connessione SignalR chiamando il `Stop` (metodo), la connessione SignalR e la connessione di trasporto iniziano e finiscono a nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="89cc6-169">When there are no connection problems, and the user application ends the SignalR connection by calling the `Stop` method, the SignalR connection and the transport connection begin and end at about the same time.</span></span> <span data-ttu-id="89cc6-170">Le sezioni seguenti descrivono in dettaglio gli altri scenari.</span><span class="sxs-lookup"><span data-stu-id="89cc6-170">The following sections describe in more detail the other scenarios.</span></span>

<a id="transportdisconnect"></a>

### <a name="transport-disconnection-scenarios"></a><span data-ttu-id="89cc6-171">Scenari di disconnessione del trasporto</span><span class="sxs-lookup"><span data-stu-id="89cc6-171">Transport disconnection scenarios</span></span>

<span data-ttu-id="89cc6-172">Connessioni fisiche potrebbero risultare lente o potrebbero essere presenti interruzioni della connettività.</span><span class="sxs-lookup"><span data-stu-id="89cc6-172">Physical connections might be slow or there might be interruptions in connectivity.</span></span> <span data-ttu-id="89cc6-173">A seconda di fattori quali la lunghezza dell'interruzione, la connessione di trasporto potrebbe essere eliminata.</span><span class="sxs-lookup"><span data-stu-id="89cc6-173">Depending on factors such as the length of the interruption, the transport connection might be dropped.</span></span> <span data-ttu-id="89cc6-174">SignalR quindi tenta di ristabilire la connessione di trasporto.</span><span class="sxs-lookup"><span data-stu-id="89cc6-174">SignalR then tries to re-establish the transport connection.</span></span> <span data-ttu-id="89cc6-175">In alcuni casi l'API di connessione di trasporto rileva l'interruzione e rilascia la connessione di trasporto e SignalR scopre immediatamente che la connessione viene persa.</span><span class="sxs-lookup"><span data-stu-id="89cc6-175">Sometimes the transport connection API detects the interruption and drops the transport connection, and SignalR finds out immediately that the connection is lost.</span></span> <span data-ttu-id="89cc6-176">In altri scenari, la connessione di trasporto API né SignalR viene reso compatibile con immediatamente che la connettività è stata persa.</span><span class="sxs-lookup"><span data-stu-id="89cc6-176">In other scenarios, neither the transport connection API nor SignalR becomes aware immediately that connectivity has been lost.</span></span> <span data-ttu-id="89cc6-177">Per tutti i trasporti, ad eccezione di polling di lunga durata, il client SignalR utilizza una funzione denominata *keepalive* per verificare la presenza di una perdita di connettività, tra cui il trasporto API è in grado di rilevare.</span><span class="sxs-lookup"><span data-stu-id="89cc6-177">For all transports except long polling, the SignalR client uses a function called *keepalive* to check for loss of connectivity that the transport API is unable to detect.</span></span> <span data-ttu-id="89cc6-178">Per informazioni sulle connessioni di long polling, vedere [impostazioni di Timeout e keepalive](#timeoutkeepalive) più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="89cc6-178">For information about long polling connections, see [Timeout and keepalive settings](#timeoutkeepalive) later in this topic.</span></span>

<span data-ttu-id="89cc6-179">Quando una connessione è inattiva, periodicamente il server invia un pacchetto di keepalive al client.</span><span class="sxs-lookup"><span data-stu-id="89cc6-179">When a connection is inactive, periodically the server sends a keepalive packet to the client.</span></span> <span data-ttu-id="89cc6-180">Alla data che viene scritto questo articolo, la frequenza predefinita è ogni 10 secondi.</span><span class="sxs-lookup"><span data-stu-id="89cc6-180">As of the date this article is being written, the default frequency is every 10 seconds.</span></span> <span data-ttu-id="89cc6-181">Rimanendo in ascolto di questi pacchetti, i client possono indicare se si verifica un problema di connessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-181">By listening for these packets, clients can tell if there is a connection problem.</span></span> <span data-ttu-id="89cc6-182">Se un pacchetto di keepalive non viene ricevuto quando previsto, dopo un breve periodo di tempo il client presuppone che siano presenti problemi di connessione, ad esempio lentezza o interruzioni.</span><span class="sxs-lookup"><span data-stu-id="89cc6-182">If a keepalive packet is not received when expected, after a short time the client assumes that there are connection problems such as slowness or interruptions.</span></span> <span data-ttu-id="89cc6-183">Se il keepalive non viene comunque ricevuta dopo un periodo di tempo più lungo, il client presuppone che la connessione è stata eliminata, e inizia il tentativo di riconnessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-183">If the keepalive is still not received after a longer time, the client assumes that the connection has been dropped, and it begins trying to reconnect.</span></span>

<span data-ttu-id="89cc6-184">Il diagramma seguente illustra gli eventi client e server che vengono generati in uno scenario tipico quando si verificano problemi con la connessione fisica che non sono immediatamente riconosciuti dal trasporto API.</span><span class="sxs-lookup"><span data-stu-id="89cc6-184">The following diagram illustrates the client and server events that are raised in a typical scenario when there are problems with the physical connection that aren't immediately recognized by the transport API.</span></span> <span data-ttu-id="89cc6-185">Il diagramma si applica a circostanze seguenti:</span><span class="sxs-lookup"><span data-stu-id="89cc6-185">The diagram applies to the following circumstances:</span></span>

- <span data-ttu-id="89cc6-186">Il trasporto è WebSockets, forever frame o gli eventi inviati al server.</span><span class="sxs-lookup"><span data-stu-id="89cc6-186">The transport is WebSockets, forever frame, or server-sent events.</span></span>
- <span data-ttu-id="89cc6-187">Esistono diversi periodi di interruzione della connessione di rete fisica.</span><span class="sxs-lookup"><span data-stu-id="89cc6-187">There are varying periods of interruption in the physical network connection.</span></span>
- <span data-ttu-id="89cc6-188">Il trasporto API non viene comunicato interruzioni, in modo da SignalR si basa sulla funzionalità di keepalive rilevarle.</span><span class="sxs-lookup"><span data-stu-id="89cc6-188">The transport API does not become aware of the interruptions, so SignalR relies on the keepalive functionality to detect them.</span></span>

![Disconnessioni di trasporto](handling-connection-lifetime-events/_static/image2.png)

<span data-ttu-id="89cc6-190">Se il client passa alla modalità di riconnessione, ma non riesce a stabilire una connessione di trasporto entro il limite di timeout di disconnessione, il server termina la connessione di SignalR.</span><span class="sxs-lookup"><span data-stu-id="89cc6-190">If the client goes into reconnecting mode but can't establish a transport connection within the disconnect timeout limit, the server terminates the SignalR connection.</span></span> <span data-ttu-id="89cc6-191">In questo caso, il server esegue l'Hub `OnDisconnected` metodo e le code di un messaggio di disconnessione da inviare al client nel caso in cui il client riesce a connettersi più tardi.</span><span class="sxs-lookup"><span data-stu-id="89cc6-191">When that happens, the server executes the Hub's `OnDisconnected` method and queues up a disconnect message to send to the client in case the client manages to connect later.</span></span> <span data-ttu-id="89cc6-192">Se il client quindi ristabilire la connessione, riceve il comando di disconnessione e chiama il `Stop` (metodo).</span><span class="sxs-lookup"><span data-stu-id="89cc6-192">If the client then does reconnect, it receives the disconnect command and calls the `Stop` method.</span></span> <span data-ttu-id="89cc6-193">In questo scenario `OnReconnected` non viene eseguito quando il client si riconnette, e `OnDisconnected` non viene eseguito quando il client chiama `Stop`.</span><span class="sxs-lookup"><span data-stu-id="89cc6-193">In this scenario, `OnReconnected` is not executed when the client reconnects, and `OnDisconnected` is not executed when the client calls `Stop`.</span></span> <span data-ttu-id="89cc6-194">Il diagramma seguente illustra questo scenario.</span><span class="sxs-lookup"><span data-stu-id="89cc6-194">The following diagram illustrates this scenario.</span></span>

![Interruzioni di trasporto - timeout del server](handling-connection-lifetime-events/_static/image3.png)

<span data-ttu-id="89cc6-196">Gli eventi di durata connessione SignalR che potrebbero essere generati nel client sono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="89cc6-196">The SignalR connection lifetime events that may be raised on the client are the following:</span></span>

- <span data-ttu-id="89cc6-197">`ConnectionSlow` evento client.</span><span class="sxs-lookup"><span data-stu-id="89cc6-197">`ConnectionSlow` client event.</span></span>

    <span data-ttu-id="89cc6-198">Generato quando una set di impostazioni proporzione del periodo di timeout di keepalive è trascorsi dall'ultimo messaggio o ping keepalive è stato ricevuto.</span><span class="sxs-lookup"><span data-stu-id="89cc6-198">Raised when a preset proportion of the keepalive timeout period has passed since the last message or keepalive ping was received.</span></span> <span data-ttu-id="89cc6-199">Il periodo predefinito di avviso di timeout keepalive è 2 o 3 del timeout keepalive.</span><span class="sxs-lookup"><span data-stu-id="89cc6-199">The default keepalive timeout warning period is 2/3 of the keepalive timeout.</span></span> <span data-ttu-id="89cc6-200">Il timeout di keepalive è 20 secondi, in modo che l'avviso viene generato a circa 13 secondi.</span><span class="sxs-lookup"><span data-stu-id="89cc6-200">The keepalive timeout is 20 seconds, so the warning occurs at about 13 seconds.</span></span>

    <span data-ttu-id="89cc6-201">Per impostazione predefinita, il server invia ping keepalive ogni 10 secondi, e il client verifica ping keepalive su ogni 2 secondi (un terzo della differenza tra il valore di timeout di keepalive e il valore di avviso di timeout di keepalive).</span><span class="sxs-lookup"><span data-stu-id="89cc6-201">By default, the server sends keepalive pings every 10 seconds, and the client checks for keepalive pings about every 2 seconds (one third of the difference between the keepalive timeout value and the keepalive timeout warning value).</span></span>

    <span data-ttu-id="89cc6-202">Se il trasporto API viene a conoscenza di una disconnessione, SignalR potrebbe essere informata della disconnessione prima del timeout di avviso keepalive passa.</span><span class="sxs-lookup"><span data-stu-id="89cc6-202">If the transport API becomes aware of a disconnection, SignalR might be informed of the disconnection before the keepalive timeout warning period passes.</span></span> <span data-ttu-id="89cc6-203">In tal caso, il `ConnectionSlow` eventi non vengono generati e SignalR verrebbe visualizzata direttamente la il `Reconnecting` evento.</span><span class="sxs-lookup"><span data-stu-id="89cc6-203">In that case, the `ConnectionSlow` event would not be raised, and SignalR would go directly to the `Reconnecting` event.</span></span>
- <span data-ttu-id="89cc6-204">`Reconnecting` evento client.</span><span class="sxs-lookup"><span data-stu-id="89cc6-204">`Reconnecting` client event.</span></span>

    <span data-ttu-id="89cc6-205">Generato quando l'API (a) il trasporto rileva che la connessione viene persa, o (b) il periodo di timeout di keepalive è trascorsi dall'ultimo messaggio o ping keepalive è stato ricevuto.</span><span class="sxs-lookup"><span data-stu-id="89cc6-205">Raised when (a) the transport API detects that the connection is lost, or (b) the keepalive timeout period has passed since the last message or keepalive ping was received.</span></span> <span data-ttu-id="89cc6-206">Il codice del client SignalR inizia tentativo di riconnessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-206">The SignalR client code begins trying to reconnect.</span></span> <span data-ttu-id="89cc6-207">Se si desidera che l'applicazione per eseguire qualche azione quando una connessione di trasporto viene persa, è possibile gestire questo evento.</span><span class="sxs-lookup"><span data-stu-id="89cc6-207">You can handle this event if you want your application to take some action when a transport connection is lost.</span></span> <span data-ttu-id="89cc6-208">Attualmente, il periodo di timeout predefinito di keepalive è 20 secondi.</span><span class="sxs-lookup"><span data-stu-id="89cc6-208">The default keepalive timeout period is currently 20 seconds.</span></span>

    <span data-ttu-id="89cc6-209">Se il codice client prova a chiamare un metodo dell'Hub durante la riconnessione modalità SignalR, SignalR tenterà di inviare il comando.</span><span class="sxs-lookup"><span data-stu-id="89cc6-209">If your client code tries to call a Hub method while SignalR is in reconnecting mode, SignalR will try to send the command.</span></span> <span data-ttu-id="89cc6-210">La maggior parte dei casi, tali tentativi avranno esito negativo, ma in alcuni casi si potrebbe avere esito positivo.</span><span class="sxs-lookup"><span data-stu-id="89cc6-210">Most of the time, such attempts will fail, but in some circumstances they might succeed.</span></span> <span data-ttu-id="89cc6-211">Per il server ha inviato, forever frame ed eventi long polling trasporti, SignalR utilizza due canali di comunicazione, uno che il client utilizza per inviare messaggi e uno che utilizza per ricevere messaggi.</span><span class="sxs-lookup"><span data-stu-id="89cc6-211">For the server-sent events, forever frame, and long polling transports, SignalR uses two communication channels, one that the client uses to send messages and one that it uses to receive messages.</span></span> <span data-ttu-id="89cc6-212">Il canale utilizzato per la ricezione è quello aperto in modo permanente e che è quello che viene chiusa quando viene interrotta la connessione fisica.</span><span class="sxs-lookup"><span data-stu-id="89cc6-212">The channel used for receiving is the permanently open one, and that's the one that is closed when the physical connection is interrupted.</span></span> <span data-ttu-id="89cc6-213">Il canale utilizzato per l'invio di rimane disponibile e in modo che se viene ripristinata la connettività fisica, una chiamata al metodo dal client al server potrebbe essere eseguita correttamente prima che il canale di ricezione viene ristabilito.</span><span class="sxs-lookup"><span data-stu-id="89cc6-213">The channel used for sending remains available, so if physical connectivity is restored, a method call from client to server might be successful before the receive channel is re-established.</span></span> <span data-ttu-id="89cc6-214">Il valore restituito potrebbe non essere ricevuto fino a quando non SignalR riapre il canale utilizzato per la ricezione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-214">The return value would not be received until SignalR re-opens the channel used for receiving.</span></span>
- <span data-ttu-id="89cc6-215">`Reconnected` evento client.</span><span class="sxs-lookup"><span data-stu-id="89cc6-215">`Reconnected` client event.</span></span>

    <span data-ttu-id="89cc6-216">Generato quando viene ristabilita la connessione di trasporto.</span><span class="sxs-lookup"><span data-stu-id="89cc6-216">Raised when the transport connection is reestablished.</span></span> <span data-ttu-id="89cc6-217">Il `OnReconnected` esegue il gestore eventi nell'Hub.</span><span class="sxs-lookup"><span data-stu-id="89cc6-217">The `OnReconnected` event handler in the Hub executes.</span></span>
- <span data-ttu-id="89cc6-218">`Closed` evento del client (`disconnected` eventi in JavaScript).</span><span class="sxs-lookup"><span data-stu-id="89cc6-218">`Closed` client event (`disconnected` event in JavaScript).</span></span>

    <span data-ttu-id="89cc6-219">Generato al termine del periodo di timeout di disconnessione mentre il codice del client SignalR è un tentativo di riconnessione dopo aver perso la connessione di trasporto.</span><span class="sxs-lookup"><span data-stu-id="89cc6-219">Raised when the disconnect timeout period expires while the SignalR client code is trying to reconnect after losing the transport connection.</span></span> <span data-ttu-id="89cc6-220">Disconnettere l'impostazione predefinita il timeout è 30 secondi.</span><span class="sxs-lookup"><span data-stu-id="89cc6-220">The default disconnect timeout is 30 seconds.</span></span> <span data-ttu-id="89cc6-221">(Questo evento viene generato anche quando la connessione viene interrotta perché il `Stop` viene chiamato il metodo.)</span><span class="sxs-lookup"><span data-stu-id="89cc6-221">(This event is also raised when the connection ends because the `Stop` method is called.)</span></span>

<span data-ttu-id="89cc6-222">Interruzioni di connessione di trasporto che non vengono rilevate dal trasporto API e non rimandare la ricezione di keepalive ping dal server per più tempo rispetto al periodo di avviso di timeout di keepalive potrebbero non causare la generazione di eventi di durata di qualsiasi connessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-222">Transport connection interruptions that are not detected by the transport API and don't delay the reception of keepalive pings from the server for longer than the keepalive timeout warning period might not cause any connection lifetime events to be raised.</span></span>

<span data-ttu-id="89cc6-223">Alcuni ambienti di rete deliberatamente chiudono le connessioni inattive e un'altra funzione dei pacchetti di keepalive è per evitare questo problema consentendo di che queste reti sapere che una connessione SignalR è in uso.</span><span class="sxs-lookup"><span data-stu-id="89cc6-223">Some network environments deliberately close idle connections, and another function of the keepalive packets is to help prevent this by letting these networks know that a SignalR connection is in use.</span></span> <span data-ttu-id="89cc6-224">In casi estremi la frequenza predefinita di keepalive ping potrebbe non essere sufficiente a impedire connessioni chiuse.</span><span class="sxs-lookup"><span data-stu-id="89cc6-224">In extreme cases the default frequency of keepalive pings might not be enough to prevent closed connections.</span></span> <span data-ttu-id="89cc6-225">In tal caso è possibile configurare keepalive ping da inviare più spesso.</span><span class="sxs-lookup"><span data-stu-id="89cc6-225">In that case you can configure keepalive pings to be sent more often.</span></span> <span data-ttu-id="89cc6-226">Per altre informazioni, vedere [impostazioni di Timeout e keepalive](#timeoutkeepalive) più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="89cc6-226">For more information, see [Timeout and keepalive settings](#timeoutkeepalive) later in this topic.</span></span>

> [!NOTE]
>
> <span data-ttu-id="89cc6-227">**Importante**: Non è garantita la sequenza di eventi descritte di seguito.</span><span class="sxs-lookup"><span data-stu-id="89cc6-227">**Important**: The sequence of events described here is not guaranteed.</span></span> <span data-ttu-id="89cc6-228">SignalR esegue ogni tentativo di generare eventi di durata connessione in modo prevedibile in base a questo schema, ma esistono molte varianti degli eventi di rete e molti modi in cui Framework di comunicazione sottostante, ad esempio trasporto API gestirle.</span><span class="sxs-lookup"><span data-stu-id="89cc6-228">SignalR makes every attempt to raise connection lifetime events in a predictable manner according to this scheme, but there are many variations of network events and many ways in which underlying communications frameworks such as transport APIs handle them.</span></span> <span data-ttu-id="89cc6-229">Ad esempio, il `Reconnected` evento potrebbe non essere generato quando il client si riconnette, o `OnConnected` gestore nel server è possibile eseguire quando il tentativo di stabilire una connessione ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="89cc6-229">For example, the `Reconnected` event might not be raised when the client reconnects, or the `OnConnected` handler on the server might run when the attempt to establish a connection is unsuccessful.</span></span> <span data-ttu-id="89cc6-230">In questo argomento descrive solo gli effetti che può essere prodotto generalmente da determinate circostanze tipiche.</span><span class="sxs-lookup"><span data-stu-id="89cc6-230">This topic describes only the effects that would normally be produced by certain typical circumstances.</span></span>


<a id="clientdisconnect"></a>

### <a name="client-disconnection-scenarios"></a><span data-ttu-id="89cc6-231">Scenari di disconnessione client</span><span class="sxs-lookup"><span data-stu-id="89cc6-231">Client disconnection scenarios</span></span>

<span data-ttu-id="89cc6-232">In un client browser, il codice client SignalR che mantiene una connessione SignalR viene eseguito nel contesto di una pagina web JavaScript.</span><span class="sxs-lookup"><span data-stu-id="89cc6-232">In a browser client, the SignalR client code that maintains a SignalR connection runs in the JavaScript context of a web page.</span></span> <span data-ttu-id="89cc6-233">Che è il motivo per cui la connessione SignalR deve terminare quando si passa da una pagina a un'altra e tale del motivo per cui sono presenti più connessioni con ID di connessione più se ci si connette da più finestre del browser o nelle schede.</span><span class="sxs-lookup"><span data-stu-id="89cc6-233">That's why the SignalR connection has to end when you navigate from one page to another, and that's why you have multiple connections with multiple connection IDs if you connect from multiple browser windows or tabs.</span></span> <span data-ttu-id="89cc6-234">Quando l'utente chiude una finestra del browser o una scheda, o si passa a una nuova pagina o aggiorna la pagina, la connessione SignalR termina immediatamente perché il codice client SignalR gestisce tale evento browser per l'utente e le chiamate di `Stop` (metodo).</span><span class="sxs-lookup"><span data-stu-id="89cc6-234">When the user closes a browser window or tab, or navigates to a new page or refreshes the page, the SignalR connection immediately ends because SignalR client code handles that browser event for you and calls the `Stop` method.</span></span> <span data-ttu-id="89cc6-235">In questi scenari, o in qualsiasi piattaforma client quando l'applicazione chiama il `Stop` metodo, il `OnDisconnected` gestore eventi esegue immediatamente nel server e il client genera il `Closed` evento (l'evento è denominato `disconnected` in JavaScript).</span><span class="sxs-lookup"><span data-stu-id="89cc6-235">In these scenarios, or in any client platform when your application calls the `Stop` method, the `OnDisconnected` event handler executes immediately on the server and the client raises the `Closed` event (the event is named `disconnected` in JavaScript).</span></span>

<span data-ttu-id="89cc6-236">Se un'applicazione client o il computer in cui è in esecuzione su arresti anomali o passa alla modalità di sospensione (ad esempio, quando l'utente chiude il portatile), il server non sia informato sui cosa è successo.</span><span class="sxs-lookup"><span data-stu-id="89cc6-236">If a client application or the computer that it's running on crashes or goes to sleep (for example, when the user closes the laptop), the server is not informed about what happened.</span></span> <span data-ttu-id="89cc6-237">Per quanto riguarda il server riconosce, la perdita del client potrebbe essere dovuto a un'interruzione della connettività e il client potrebbe tentare di ristabilire la connessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-237">As far as the server knows, the loss of the client might be due to connectivity interruption and the client might be trying to reconnect.</span></span> <span data-ttu-id="89cc6-238">Pertanto, in questi scenari il server è in attesa per dare la possibilità di ristabilire la connessione, il client e `OnDisconnected` non viene eseguito fino alla scadenza del periodo di timeout di disconnessione (circa 30 secondi per impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="89cc6-238">Therefore, in these scenarios the server waits to give the client a chance to reconnect, and `OnDisconnected` does not execute until the disconnect timeout period expires (about 30 seconds by default).</span></span> <span data-ttu-id="89cc6-239">Il diagramma seguente illustra questo scenario.</span><span class="sxs-lookup"><span data-stu-id="89cc6-239">The following diagram illustrates this scenario.</span></span>

![Errore del computer client](handling-connection-lifetime-events/_static/image4.png)

<a id="serverdisconnect"></a>

### <a name="server-disconnection-scenarios"></a><span data-ttu-id="89cc6-241">Scenari di disconnessione del server</span><span class="sxs-lookup"><span data-stu-id="89cc6-241">Server disconnection scenarios</span></span>

<span data-ttu-id="89cc6-242">Quando un server è offline, viene riavviato, ha esito negativo, il dominio dell'applicazione comportano il riciclo e così via, il risultato potrebbe essere simile a una connessione è stata persa o l'API di trasporto e SignalR potrebbe rendersi immediatamente che il server non è più presente e SignalR potrebbe iniziare tentativo di riconnessione senza generazione di `ConnectionSlow` evento.</span><span class="sxs-lookup"><span data-stu-id="89cc6-242">When a server goes offline -- it reboots, fails, the app domain recycles, etc. -- the result might be similar to a lost connection, or the transport API and SignalR might know immediately that the server is gone, and SignalR might begin trying to reconnect without raising the `ConnectionSlow` event.</span></span> <span data-ttu-id="89cc6-243">Se il client passa alla modalità di riconnessione e se viene ripristinato il server o viene riavviata o un nuovo server viene portato online prima che scada il periodo di timeout di disconnessione, il client si riconnetterà al server nuovo o ripristinato.</span><span class="sxs-lookup"><span data-stu-id="89cc6-243">If the client goes into reconnecting mode, and if the server recovers or restarts or a new server is brought online before the disconnect timeout period expires, the client will reconnect to the restored or new server.</span></span> <span data-ttu-id="89cc6-244">In tal caso, la connessione SignalR continua sul client e il `Reconnected` viene generato l'evento.</span><span class="sxs-lookup"><span data-stu-id="89cc6-244">In that case, the SignalR connection continues on the client and the `Reconnected` event is raised.</span></span> <span data-ttu-id="89cc6-245">Nel primo server, `OnDisconnected` non viene mai eseguito e nel nuovo server, `OnReconnected` viene eseguita anche se `OnConnected` è stata mai eseguita per tale client in tale server prima.</span><span class="sxs-lookup"><span data-stu-id="89cc6-245">On the first server, `OnDisconnected` is never executed, and on the new server, `OnReconnected` is executed although `OnConnected` was never executed for that client on that server before.</span></span> <span data-ttu-id="89cc6-246">(L'effetto è lo stesso se il client si riconnette nello stesso server dopo il riciclo del dominio un riavvio o app, perché al riavvio del server non ha memoria dell'attività di connessione precedente). Il diagramma seguente si presuppone che il trasporto API viene a conoscenza della connessione persa immediatamente, pertanto la `ConnectionSlow` non viene generato l'evento.</span><span class="sxs-lookup"><span data-stu-id="89cc6-246">(The effect is the same if the client reconnects to the same server after a reboot or app domain recycle, because when the server restarts it has no memory of prior connection activity.) The following diagram assumes that the transport API becomes aware of the lost connection immediately, so the `ConnectionSlow` event is not raised.</span></span>

![Errore del server e la riconnessione](handling-connection-lifetime-events/_static/image5.png)

<span data-ttu-id="89cc6-248">Se un server non diventa disponibile entro il periodo di timeout di disconnessione, termina la connessione di SignalR.</span><span class="sxs-lookup"><span data-stu-id="89cc6-248">If a server does not become available within the disconnect timeout period, the SignalR connection ends.</span></span> <span data-ttu-id="89cc6-249">In questo scenario, il `Closed` eventi (`disconnected` nel client JavaScript) viene generato nel client ma `OnDisconnected` non viene mai chiamato sul server.</span><span class="sxs-lookup"><span data-stu-id="89cc6-249">In this scenario, the `Closed` event (`disconnected` in JavaScript clients) is raised on the client but `OnDisconnected` is never called on the server.</span></span> <span data-ttu-id="89cc6-250">Il diagramma seguente si presuppone che il trasporto API non vengano rilevato la connessione è stata persa, in modo che è stato rilevato dalla funzionalità di keepalive SignalR e `ConnectionSlow` viene generato l'evento.</span><span class="sxs-lookup"><span data-stu-id="89cc6-250">The following diagram assumes that the transport API does not become aware of the lost connection, so it is detected by SignalR keepalive functionality and the `ConnectionSlow` event is raised.</span></span>

![Errore del server e timeout](handling-connection-lifetime-events/_static/image6.png)

<a id="timeoutkeepalive"></a>

## <a name="timeout-and-keepalive-settings"></a><span data-ttu-id="89cc6-252">Impostazioni di timeout e keepalive</span><span class="sxs-lookup"><span data-stu-id="89cc6-252">Timeout and keepalive settings</span></span>

<span data-ttu-id="89cc6-253">Il valore predefinito `ConnectionTimeout`, `DisconnectTimeout`, e `KeepAlive` valori appropriati per la maggior parte degli scenari, ma può essere modificati se l'ambiente ha particolari esigenze.</span><span class="sxs-lookup"><span data-stu-id="89cc6-253">The default `ConnectionTimeout`, `DisconnectTimeout`, and `KeepAlive` values are appropriate for most scenarios but can be changed if your environment has special needs.</span></span> <span data-ttu-id="89cc6-254">Ad esempio, se l'ambiente di rete chiude le connessioni che sono inattive per 5 secondi, potrebbe essere necessario ridurre il valore di keepalive.</span><span class="sxs-lookup"><span data-stu-id="89cc6-254">For example, if your network environment closes connections that are idle for 5 seconds, you might have to decrease the keepalive value.</span></span>

<a id="connectiontimeout"></a>

### <a name="connectiontimeout"></a><span data-ttu-id="89cc6-255">ConnectionTimeout</span><span class="sxs-lookup"><span data-stu-id="89cc6-255">ConnectionTimeout</span></span>

<span data-ttu-id="89cc6-256">Questa impostazione rappresenta la quantità di tempo per lasciare una connessione di trasporto aperte e in attesa di una risposta prima di chiuderla e aprire una nuova connessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-256">This setting represents the amount of time to leave a transport connection open and waiting for a response before closing it and opening a new connection.</span></span> <span data-ttu-id="89cc6-257">Il valore predefinito è 110 secondi.</span><span class="sxs-lookup"><span data-stu-id="89cc6-257">The default value is 110 seconds.</span></span>

<span data-ttu-id="89cc6-258">Questa impostazione si applica solo quando la funzionalità di keepalive è disabilitata, che in genere si applica solo a long trasporto di polling.</span><span class="sxs-lookup"><span data-stu-id="89cc6-258">This setting applies only when keepalive functionality is disabled, which normally applies only to the long polling transport.</span></span> <span data-ttu-id="89cc6-259">Il diagramma seguente illustra l'effetto di questa impostazione su un valore long della connessione di trasporto di polling.</span><span class="sxs-lookup"><span data-stu-id="89cc6-259">The following diagram illustrates the effect of this setting on a long polling transport connection.</span></span>

![Durata connessione di trasporto di polling](handling-connection-lifetime-events/_static/image7.png)

<a id="disconnecttimeout"></a>

### <a name="disconnecttimeout"></a><span data-ttu-id="89cc6-261">DisconnectTimeout</span><span class="sxs-lookup"><span data-stu-id="89cc6-261">DisconnectTimeout</span></span>

<span data-ttu-id="89cc6-262">Questa impostazione rappresenta la quantità di tempo di attesa dopo che una connessione di trasporto viene interrotta prima che venga generato il `Disconnected` evento.</span><span class="sxs-lookup"><span data-stu-id="89cc6-262">This setting represents the amount of time to wait after a transport connection is lost before raising the `Disconnected` event.</span></span> <span data-ttu-id="89cc6-263">Il valore predefinito è 30 secondi.</span><span class="sxs-lookup"><span data-stu-id="89cc6-263">The default value is 30 seconds.</span></span> <span data-ttu-id="89cc6-264">Quando si imposta `DisconnectTimeout`, `KeepAlive` viene impostata automaticamente su 1 o 3 del `DisconnectTimeout` valore.</span><span class="sxs-lookup"><span data-stu-id="89cc6-264">When you set `DisconnectTimeout`, `KeepAlive` is automatically set to 1/3 of the `DisconnectTimeout` value.</span></span>

<a id="keepalive"></a>

### <a name="keepalive"></a><span data-ttu-id="89cc6-265">KeepAlive</span><span class="sxs-lookup"><span data-stu-id="89cc6-265">KeepAlive</span></span>

<span data-ttu-id="89cc6-266">Questa impostazione rappresenta la quantità di tempo di attesa prima dell'invio di un pacchetto di keepalive su una connessione inattiva.</span><span class="sxs-lookup"><span data-stu-id="89cc6-266">This setting represents the amount of time to wait before sending a keepalive packet over an idle connection.</span></span> <span data-ttu-id="89cc6-267">Il valore predefinito è 10 secondi.</span><span class="sxs-lookup"><span data-stu-id="89cc6-267">The default value is 10 seconds.</span></span> <span data-ttu-id="89cc6-268">Questo valore non deve essere più di 1 o 3 del `DisconnectTimeout` valore.</span><span class="sxs-lookup"><span data-stu-id="89cc6-268">This value must not be more than 1/3 of the `DisconnectTimeout` value.</span></span>

<span data-ttu-id="89cc6-269">Se si desidera impostare entrambe `DisconnectTimeout` e `KeepAlive`, impostare `KeepAlive` dopo `DisconnectTimeout`.</span><span class="sxs-lookup"><span data-stu-id="89cc6-269">If you want to set both `DisconnectTimeout` and `KeepAlive`, set `KeepAlive` after `DisconnectTimeout`.</span></span> <span data-ttu-id="89cc6-270">In caso contrario, il `KeepAlive` impostazione verrà sovrascritto quando `DisconnectTimeout` imposta automaticamente `KeepAlive` a 1/3 del valore di timeout.</span><span class="sxs-lookup"><span data-stu-id="89cc6-270">Otherwise your `KeepAlive` setting will be overwritten when `DisconnectTimeout` automatically sets `KeepAlive` to 1/3 of the timeout value.</span></span>

<span data-ttu-id="89cc6-271">Se si desidera disabilitare la funzionalità di keepalive, impostare `KeepAlive` su null.</span><span class="sxs-lookup"><span data-stu-id="89cc6-271">If you want to disable keepalive functionality, set `KeepAlive` to null.</span></span> <span data-ttu-id="89cc6-272">La funzionalità di KeepAlive verrà disabilitata automaticamente per il valore long trasporto di polling.</span><span class="sxs-lookup"><span data-stu-id="89cc6-272">Keepalive functionality is automatically disabled for the long polling transport.</span></span>

<a id="changetimeout"></a>

### <a name="how-to-change-timeout-and-keepalive-settings"></a><span data-ttu-id="89cc6-273">Come modificare le impostazioni di timeout e keepalive</span><span class="sxs-lookup"><span data-stu-id="89cc6-273">How to change timeout and keepalive settings</span></span>

<span data-ttu-id="89cc6-274">Per modificare i valori predefiniti per queste impostazioni, impostarle nelle `Application_Start` nella *Global. asax* file, come illustrato nell'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="89cc6-274">To change the default values for these settings, set them in `Application_Start` in your *Global.asax* file, as shown in the following example.</span></span> <span data-ttu-id="89cc6-275">I valori mostrati nell'esempio di codice sono lo stesso come valori predefiniti.</span><span class="sxs-lookup"><span data-stu-id="89cc6-275">The values shown in the sample code are the same as the default values.</span></span>

[!code-csharp[Main](handling-connection-lifetime-events/samples/sample1.cs)]

<a id="notifydisconnect"></a>

## <a name="how-to-notify-the-user-about-disconnections"></a><span data-ttu-id="89cc6-276">Come inviare una notifica all'utente disconnessioni</span><span class="sxs-lookup"><span data-stu-id="89cc6-276">How to notify the user about disconnections</span></span>

<span data-ttu-id="89cc6-277">In alcune applicazioni è possibile visualizzare un messaggio all'utente quando sono presenti problemi di connettività.</span><span class="sxs-lookup"><span data-stu-id="89cc6-277">In some applications you might want to display a message to the user when there are connectivity problems.</span></span> <span data-ttu-id="89cc6-278">Sono disponibili diverse opzioni per informazioni su come e quando eseguire questa operazione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-278">You have several options for how and when to do this.</span></span> <span data-ttu-id="89cc6-279">Gli esempi di codice seguenti sono per un client JavaScript tramite il proxy generato.</span><span class="sxs-lookup"><span data-stu-id="89cc6-279">The following code samples are for a JavaScript client using the generated proxy.</span></span>

- <span data-ttu-id="89cc6-280">Gestire il `connectionSlow` evento per visualizzare un messaggio appena SignalR è a conoscenza di problemi di connessione, prima dell'aggiunta alla modalità di riconnessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-280">Handle the `connectionSlow` event to display a message as soon as SignalR is aware of connection problems, before it goes into reconnecting mode.</span></span>

    [!code-javascript[Main](handling-connection-lifetime-events/samples/sample2.js)]
- <span data-ttu-id="89cc6-281">Gestire il `reconnecting` evento per visualizzare un messaggio quando SignalR è a conoscenza di una disconnessione e si sta entrando in modalità di riconnessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-281">Handle the `reconnecting` event to display a message when SignalR is aware of a disconnection and is going into reconnecting mode.</span></span>

    [!code-javascript[Main](handling-connection-lifetime-events/samples/sample3.js)]
- <span data-ttu-id="89cc6-282">Gestire il `disconnected` evento per visualizzare un messaggio quando un tentativo di riconnessione è scaduta. In questo scenario, l'unico modo per ristabilire una connessione con il server è necessario riavviare la connessione SignalR chiamando il `Start` metodo, che verrà creato un nuovo ID di connessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-282">Handle the `disconnected` event to display a message when an attempt to reconnect has timed out. In this scenario, the only way to re-establish a connection with the server again is to restart the SignalR connection by calling the `Start` method, which will create a new connection ID.</span></span> <span data-ttu-id="89cc6-283">Esempio di codice seguente viene usato un flag per assicurarsi che si esegue la notifica solo dopo un timeout di riconnessione, non dopo un normale fine per la connessione SignalR indotte chiamando il `Stop` (metodo).</span><span class="sxs-lookup"><span data-stu-id="89cc6-283">The following code sample uses a flag to make sure that you issue the notification only after a reconnecting timeout, not after a normal end to the SignalR connection caused by calling the `Stop` method.</span></span>

    [!code-javascript[Main](handling-connection-lifetime-events/samples/sample4.js)]

<a id="continuousreconnect"></a>

## <a name="how-to-continuously-reconnect"></a><span data-ttu-id="89cc6-284">Modalità di riconnessione in modo continuo</span><span class="sxs-lookup"><span data-stu-id="89cc6-284">How to continuously reconnect</span></span>

<span data-ttu-id="89cc6-285">In alcune applicazioni potrebbe voler automaticamente ristabilire una connessione dopo che è stata persa e il tentativo di riconnessione è scaduta. A tale scopo, è possibile chiamare il `Start` metodo dal `Closed` gestore dell'evento (`disconnected` gestore dell'evento nei client JavaScript).</span><span class="sxs-lookup"><span data-stu-id="89cc6-285">In some applications you might want to automatically re-establish a connection after it has been lost and the attempt to reconnect has timed out. To do that, you can call the `Start` method from your `Closed` event handler (`disconnected` event handler on JavaScript clients).</span></span> <span data-ttu-id="89cc6-286">Si potrebbe voler attendere un periodo di tempo prima di chiamare `Start` per evitare questa operazione troppo frequentemente quando il server o la connessione fisica non sono disponibili.</span><span class="sxs-lookup"><span data-stu-id="89cc6-286">You might want to wait a period of time before calling `Start` in order to avoid doing this too frequently when the server or the physical connection are unavailable.</span></span> <span data-ttu-id="89cc6-287">Esempio di codice seguente è per un client JavaScript tramite il proxy generato.</span><span class="sxs-lookup"><span data-stu-id="89cc6-287">The following code sample is for a JavaScript client using the generated proxy.</span></span>

[!code-javascript[Main](handling-connection-lifetime-events/samples/sample5.js)]

<span data-ttu-id="89cc6-288">Un potenziale problema da considerare nel client per dispositivi mobili è che i tentativi di riconnessione continua quando il server o una connessione fisica non è disponibile può causare inutili della batteria.</span><span class="sxs-lookup"><span data-stu-id="89cc6-288">A potential problem to be aware of in mobile clients is that continuous reconnection attempts when the server or physical connection isn't available could cause unnecessary battery drain.</span></span>

<a id="disconnectclientfromserver"></a>

## <a name="how-to-disconnect-a-client-in-server-code"></a><span data-ttu-id="89cc6-289">Come disconnettere un client nel codice server</span><span class="sxs-lookup"><span data-stu-id="89cc6-289">How to disconnect a client in server code</span></span>

<span data-ttu-id="89cc6-290">SignalR versione 2 non è un server incorporato API per la disconnessione dei client.</span><span class="sxs-lookup"><span data-stu-id="89cc6-290">SignalR version 2 does not have a built-in server API for disconnecting clients.</span></span> <span data-ttu-id="89cc6-291">Esistono [piani per l'aggiunta di questa funzionalità in futuro](https://github.com/SignalR/SignalR/issues/2101).</span><span class="sxs-lookup"><span data-stu-id="89cc6-291">There are [plans for adding this functionality in the future](https://github.com/SignalR/SignalR/issues/2101).</span></span> <span data-ttu-id="89cc6-292">Nella versione di SignalR corrente, il modo più semplice per disconnettere un client dal server è per implementare un metodo di disconnessione nel client e chiamare il metodo dal server.</span><span class="sxs-lookup"><span data-stu-id="89cc6-292">In the current SignalR release, the simplest way to disconnect a client from the server is to implement a disconnect method on the client and call that method from the server.</span></span> <span data-ttu-id="89cc6-293">Esempio di codice seguente viene illustrato un metodo di disconnessione per un client JavaScript tramite il proxy generato.</span><span class="sxs-lookup"><span data-stu-id="89cc6-293">The following code sample shows a disconnect method for a JavaScript client using the generated proxy.</span></span>

[!code-javascript[Main](handling-connection-lifetime-events/samples/sample6.js)]

> [!WARNING]
> <span data-ttu-id="89cc6-294">Security - questo metodo per la disconnessione dei client né l'API predefinito proposto si occuperanno lo scenario di attacco client che eseguono codice dannoso, poiché è stato possibile riconnettere i client o il codice di attacco potrebbe rimuovere il `stopClient` metodo o modifica cosa.</span><span class="sxs-lookup"><span data-stu-id="89cc6-294">Security - Neither this method for disconnecting clients nor the proposed built-in API will address the scenario of hacked clients that are running malicious code, since the clients could reconnect or the hacked code might remove the `stopClient` method or change what it does.</span></span> <span data-ttu-id="89cc6-295">Consente di implementare la protezione delle informazioni sullo stato di tipo denial of service (DOS). è non in framework o il livello del server, ma piuttosto nel front-end dell'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="89cc6-295">The appropriate place to implement stateful denial-of-service (DOS) protection is not in the framework or the server layer, but rather in front-end infrastructure.</span></span>


<a id="detectingreasonfordisconnection"></a>
## <a name="detecting-the-reason-for-a-disconnection"></a><span data-ttu-id="89cc6-296">Rilevare il motivo di una disconnessione</span><span class="sxs-lookup"><span data-stu-id="89cc6-296">Detecting the reason for a disconnection</span></span>

<span data-ttu-id="89cc6-297">2.1 SignalR aggiunge un overload per il server `OnDisconnect` evento che indica se il client disconnesso deliberatamente piuttosto che verifichi il timeout. Il `StopCalled` parametro è true se il client ha chiuso in modo esplicito la connessione.</span><span class="sxs-lookup"><span data-stu-id="89cc6-297">SignalR 2.1 adds an overload to the server `OnDisconnect` event that indicates if the client deliberately disconnected rather than timing out. The `StopCalled` parameter is true if the client explicitly closed the connection.</span></span> <span data-ttu-id="89cc6-298">In JavaScript, se un errore del server ha portato al client di disconnessione, le informazioni sull'errore verranno passati al client come `$.connection.hub.lastError`.</span><span class="sxs-lookup"><span data-stu-id="89cc6-298">In JavaScript, if a server error led the client to disconnect, the error information will be passed to the client as `$.connection.hub.lastError`.</span></span>

<span data-ttu-id="89cc6-299">**Codice lato server c#: `stopCalled` parametro**</span><span class="sxs-lookup"><span data-stu-id="89cc6-299">**C# server code: `stopCalled` parameter**</span></span>

[!code-csharp[Main](handling-connection-lifetime-events/samples/sample7.cs?highlight=1,3)]

<span data-ttu-id="89cc6-300">**Il codice JavaScript client: l'accesso a `lastError` nella `disconnect` evento.**</span><span class="sxs-lookup"><span data-stu-id="89cc6-300">**JavaScript client code: accessing `lastError` in the `disconnect` event.**</span></span>

[!code-javascript[Main](handling-connection-lifetime-events/samples/sample8.js?highlight=2-3)]
